## ✅ 로드 밸런싱

### **로드 밸런싱이란 무엇인가요?**

- 애플리케이션을 지원하는 리소스 풀 전체에 네트워크 트래픽을 균등하게 배포하는 방법

최신 애플리케이션은 수백만 명의 사용자를 동시에 처리하고 정확한 텍스트, 비디오, 이미지 및 기타 데이터를 빠르고 안정적인 방식으로 각 사용자에게 반환해야 함! 이렇게 많은 양의 트래픽을 처리하기 위해 대부분의 애플리케이션에는 데이터가 중복되는 리소스 서버가 많이 있음! 

### 1. 로드 밸런서란?

- **여러 서버에 트래픽을 분산시키는 장치 또는 기술**
- 서버 과부하 방지, 고가용성, 성능 향상 목적
- 사용자와 서버 그룹 사이에 위치하며 보이지 않는 촉진자 역할을 하여 모든 리소스 서버가 동일하게 
사용되도록 하는 디바이스

### 2. L4 vs L7 로드 밸런서

| 구분 | L4 (전송 계층) | L7 (응용 계층) |
| --- | --- | --- |
| 기준 | IP, 포트 | URL, 쿠키, HTTP 헤더 |
| 처리 단위 | TCP, UDP | HTTP, HTTPS |
| 장점 | 빠름, 단순 | 세밀한 제어 가능 |
| 예시 | LVS, HAProxy (L4) | Nginx, Envoy (L7) |

---

### 3. 로드 밸런싱의 이점과 알고리즘 종류

### 애플리케이션 가용성

서버 장애 또는 유지 관리로 인해 애플리케이션 가동 중지 시간이 늘어 방문자가 애플리케이션을 사용할 수 없게 될 수 있음!
로드 밸런서는 서버 문제를 자동으로 감지하고 클라이언트 트래픽을 사용 가능한 서버로 리디렉션하여 시스템의 내결함성을 높임
로드 밸런싱을 사용하여 다음 태스크를 더 쉽게 수행할 수 있음

- 애플리케이션 가동 중지 없이 애플리케이션 서버 유지 관리 또는 업그레이드 실행
- 백업 사이트에 자동 재해 복구 제공
- 상태 확인을 수행하고 가동 중지를 유발할 수 있는 문제 방지

### 애플리케이션 확장성

로드 밸런서를 사용하여 여러 서버 간에 네트워크 트래픽을 지능적으로 전달할 수 있음
로드 밸런싱이 다음을 수행하므로 애플리케이션에서 수천 개의 클라이언트 요청을 처리할 수 있음

- 한 서버에서 트래픽 병목 현상 방지
- 필요한 경우 다른 서버를 추가하거나 제거할 수 있도록 애플리케이션 트래픽을 예측함
- 안심하고 조정할 수 있도록 시스템에 중복성을 추가함

### 애플리케이션 보안

로드 밸런서에는 인터넷 애플리케이션에 또 다른 보안 계층을 추가할 수 있는 보안 기능이 내장되어 있음
이는 공격자가 서버 장애를 일으키는 수백만 개의 동시 요청으로 애플리케이션 서버를 가득 채우는 분산 서비스 거부 공격을 처리하는 데 유용한 도구 

하는 행동
- 트래픽 모니터링 및 악성 콘텐츠 차단
- 공격 트래픽을 여러 백엔드 서버로 자동으로 리디렉션하여 영향 최소화
- 추가 보안을 위해 네트워크 방화벽 그룹을 통해 트래픽 라우팅

### 애플리케이션 성능

로드 밸런서는 응답 시간을 늘리고 네트워크 지연 시간을 줄여 애플리케이션 성능을 향상시킴
다음과 같은 몇 가지 중요한 태스크를 수행함

- 서버 간에 로드를 균등하게 배포하여 애플리케이션 성능 향상
- 클라이언트 요청을 지리적으로 더 가까운 서버로 리디렉션하여 지연 시간 단축
- 물리적 및 가상 컴퓨팅 리소스의 신뢰성 및 성능 보장

| 알고리즘 | 설명 |
| --- | --- |
| Round Robin | 순차적으로 서버에 요청 분배 |
| Least Connections | 가장 적은 연결 수를 가진 서버에 분배 |
| IP Hash | 클라이언트 IP 해시값에 따라 서버 결정 |
| Weighted Round Robin | 서버마다 가중치 부여 (성능 차이 고려) |
| Random | 무작위 선택 |

---

### 4. 헬스 체크(Health Check) & 장애 조치(Failover)

| 항목 | 설명 |
| --- | --- |
| **헬스 체크** | 로드 밸런서가 **주기적으로 서버 상태 확인**예: `/health` 엔드포인트에 HTTP 요청 보내 응답 확인 |
| **Failover (장애 조치)** | 특정 서버가 응답하지 않거나 비정상일 경우
**자동으로 해당 서버 제외** 후 나머지 서버에 트래픽 분산 |

### 목적

- 서비스의 **무중단 운영 보장**
- 장애 시 사용자에게 **최소한의 영향**만 주도록 함
- 고가용성(HA, High Availability)을 실현하는 핵심 기술

### 예시

- 클라우드 로드 밸런서: AWS ALB, GCP Load Balancer 등은 기본적으로 헬스 체크 내장
- Nginx: `proxy_next_upstream` 설정으로 응답 실패 시 다른 서버로 요청 전달

---

### 5. DNS 기반 로드 밸런싱

로드밸런싱은 "단순한 IP 분산"까지만 가능!
서버 상태나 부하를 고려하지 못하기 때문에 대규모/실시간 트래픽 환경에는 부적절

| 항목 | 설명 |
| --- | --- |
| **작동 방식** | 하나의 도메인(www.example.com)에 **여러 IP 주소를 등록** (A 레코드 다중 등록) |
| **트래픽 분산** | DNS 서버가 클라이언트 요청에 대해 **순차적(Round Robin)** 혹은 **랜덤**으로 IP 응답 |
| **장점** | 설정이 간단하고 비용이 저렴 |

### 한계

- **실시간 장애 감지 불가**: DNS는 **서버 상태를 모름**, 죽은 서버로 응답할 수도 있음
- **TTL 캐싱 이슈**: DNS 응답 결과가 **클라이언트/ISP에 캐싱**되므로 IP 주소 변경이 **즉시 반영되지 않음**

### 보완 방법

- **클라이언트 기반 로드 밸런싱과 함께 사용**
- **CDN**이나 **Anycast DNS**를 활용하여 지역별 트래픽 최적화

---

## ✅ 웹 서버 & WAS

### 1. 정적 vs 동적 페이지

| 항목 | 정적 페이지 | 동적 페이지 |
| --- | --- | --- |
| **내용** | 고정된 콘텐츠 | 사용자 요청에 따라 실시간 생성 |
| **변경 여부** | 항상 동일 | 매 요청마다 다를 수 있음 |
| **예시** | HTML, CSS, JS, 이미지 | JSP, Servlet, PHP, Node.js |
| **처리 주체** | **웹 서버** (Nginx, Apache) | **WAS** (Tomcat, Spring Boot, Express 등) |
| **속도** | 빠름 (캐싱 가능) | 상대적으로 느림 (로직, DB 연동 필요) |
| **용도** | 정적 페이지, 리디렉션 | 로그인, 게시판, 검색 등 사용자 맞춤 처리 |

---

### 2. 웹 서버와 WAS의 역할

웹 서버(Web Server)

- **클라이언트 요청 수신 및 응답 전달**
- **정적 파일** 직접 응답 (`.html`, `.css`, `.js`, `.png`, `.ico`)
- 요청이 동적일 경우, **WAS로 요청을 프록시 처리**

> 예: Nginx, Apache, Caddy 등
> 

WAS (Web Application Server)

- 사용자 요청을 처리하는 **비즈니스 로직 수행**
- DB 접근, 세션 처리, 인증 등 **서버 사이드 로직 실행**
- 동적 콘텐츠 생성 후 웹 서버에 전달

> 예: Tomcat, Jetty, Spring Boot 내장 WAS, Node.js 등
> 

---

### 3. 협업 구조 (리버스 프록시 포함)

```
[클라이언트 브라우저 요청]
        │
        ▼
┌────────────────────┐
│   웹 서버 (Nginx)    │
│ - 정적 파일 응답       │
│ - 리버스 프록시 기능    │
└──────┬─────────────┘
       │동적 요청
       ▼
┌────────────────────┐
│      WAS (Tomcat)   │
│ - 서버 비즈니스 로직    │
│ - DB 접근 / 세션 처리  │
└────────────────────┘

```

> 웹 서버는 WAS 앞의 관문 역할을 하며, 요청을 분석해 적절한 서버로 분배
> 
> 
> 특히 리버스 프록시 설정을 통해 **보안성과 확장성**을 높일 수 있음
> 

---

### 4. 왜 웹 서버와 WAS를 분리해서 쓰는가?

| 이유 | 설명 |
| --- | --- |
| **역할 분담** | 웹 서버는 정적 리소스를 빠르게 처리, WAS는 동적 로직을 전담 |
| **보안 강화** | WAS는 외부에 노출되지 않음. 웹 서버에서 방화벽/접근 제어 가능 |
| **성능 향상** | 정적 파일은 웹 서버에서 캐싱, 압축 적용으로 빠른 응답 가능 |
| **확장성 확보** | WAS 인스턴스를 수평 확장 (로드 밸런싱) → 대규모 서비스 대응 |
| **장애 격리** | 웹 서버나 WAS 중 하나에 문제가 생겨도 영향 최소화 |
| **유지보수 용이** | 각 구성 요소를 독립적으로 업데이트 / 모니터링 가능 |