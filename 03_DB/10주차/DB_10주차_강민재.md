### [10주차] 트랜잭션과 격리 수준 (ACID + Isolation Level)

- 트랜잭션의 정의와 핵심 개념
- 트랜잭션 격리 수준(Isolation Level) 비교
- InnoDB에서의 트랜잭션 처리 방식

---

<br>

## 🔵 트랜잭션의 정의와 핵심 개념

### 트랜잭션이란 무엇인가? (데이터베이스에서의 의미)

트랜잭션은 **데이터베이스에서 하나의 논리적 작업 단위**를 의미한다.
예를 들어, 은행에서 A -> B 계좌로 송금하는 경우 출금 + 입금이 하나의 트랜잭션이다.

중간에 실패가 나면 전체 작업이 롤백(되돌리기) 되어야 하고,
성공하면 커밋(commit) 되어야 한다.

### 트랜잭션이 필요한 이유

- 일관된 데이터 상태 유지
- 시스템 오류, 동시성 문제, 중복 처리 등에서 데이터 무결성을 보장

### 트랜잭션의 4가지 속성: ACID

#### 1. Atomicity (원자성)

- 모두 성공하거나, 모두 실패해야 한다
- 중간에 실패하면 전체 트랜잭션이 무효 처리됨

#### 2. Consistency (일관성)

- 트랜잭션 실행 전후에 DB는 항상 유효한 상태를 유지해야 한다

#### 3. Isolation (격리성)

- 동시에 여러 트랜잭션이 수행될 때, 서로 간섭하지 않아야 한다

#### 4. Durability (지속성)

- 트랜잭션이 커밋되면, 시스템이 꺼져도 결과는 유지됨

---

<br>

## 🔵 트랜잭션 격리 수준(Isolation Level) 비교

### 격리 수준의 필요성과 문제점

여러 사용자가 동시에 데이터를 다룰 때, 다음과 같은 문제 발생 가능하다.

1. Dirty Read: 커밋되지 않은 데이터를 읽어버리는 현상

2. Non-repeatable Read: 같은 SELECT인데 읽는 값이 다르게 나오는 경우

3. Phantom Read: 같은 조건의 SELECT인데 결과 행 개수가 달라짐

### ANSI SQL 기준 4단계 격리 수준

1. Read Uncommitted: Dirty Read 허용 (가장 낮은 수준)

2. Read Committed: 커밋된 데이터만 읽음 (Oracle 기본값)

3. Repeatable Read: 한 트랜잭션 내에서는 동일한 값만 읽힘

4. Serializable: 완전한 격리, 트랜잭션을 순차 실행처럼 보이게 함

| 격리 수준        | Dirty Read | Non-repeatable | Phantom |
| ---------------- | ---------- | -------------- | ------- |
| Read Uncommitted | O          | O              | O       |
| Read Committed   | X          | O              | O       |
| Repeatable Read  | X          | X              | O       |
| Serializable     | X          | X              | X       |

---

<br>

## 🔵 InnoDB에서의 트랜잭션 처리 방식

### Undo 로그 / Redo 로그 개념 및 역할

- **Undo 로그**: 롤백을 위한 이전 값 저장 (트랜잭션 실패 시 복구)
- **Redo 로그**: 디스크에 반영되지 않은 성공 결과를 복구

### MVCC (다중 버전 동시성 제어)와 InnoDB의 관계

- 여러 버전의 데이터를 이용해 격리성을 유지하면서 **동시 처리 성능 향상**
- SELECT 시에도 락을 걸지 않고, 트랜잭션 시작 시점의 스냅샷을 읽는다

### Repeatable Read의 실질 구현 방식 (스냅샷 기반 읽기)

- InnoDB는 **MVCC + Undo 로그** 조합으로 Repeatable Read를 구현
- 읽는 데이터가 변경되지 않도록 버전 기반으로 보여주는 방식 사용
