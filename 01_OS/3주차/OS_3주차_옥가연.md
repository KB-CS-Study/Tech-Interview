# CPU 스케줄링 + 인터럽트 & 시스템 콜

## CPU 스케줄링 알고리즘

CPU가 어떤 프로세스를 선택할 것인지는 스케줄링알고리즘을 통해 선택되며 효율적으로 선택하는게 중요하다. 
여기서 효율적이란 것은 다음과 같은 사항을 만족시킬 때 효율적이다라고 한다.

1. CPU사용률이 높은가?
2. 단위 시간당 작업을 마친 프로세스의 수(처리량)가 높은가?
3. 작업을 요청한 프로세스가 작업을 시작하기 전 대기하는 시간은 짧은가?
   
방식은 비선점형과 선점형으로 나뉘어진다.

### 비선점형

비선점형 방식(non-preemptive)은 프로세스가 스스로 CPU 소유권을 포기하는 방식이며,
강제로 프로세스를 중지하지 않는다. 따라서 컨텍스트 스위칭으로 인한 부하가 적다.

#### FCFS

FCFS(First Come, First Served)는 가장 먼저 온 것을 가장 먼저 처리하는 알고리즘이다.
길게 수행되는 프로세스 때문에 준비 큐에서 오래 기다리는 현상(convoy effect)이 발생하는 단점이 있다.

![img](https://velog.velcdn.com/images/leesfact/post/9808b21f-bcf1-42bf-adf1-b0466d085658/image.png)

<br />

#### SJF

SJF(Shortest Job First)는 실행 시간이 가장 짧은 프로세스를 가장 먼저 실행하는 알고리즘이다. 
긴 시간을 가진 프로세스가 실행되지 않는 현상(starvation)이 일어날 수 있으며 평균 대기 시간이 가장 짧다.

하지만 실제로는 실행 시간을 알 수 없기 때문에 과거의 실행했던 시간을 토대로 추측해서 사용한다.

<br />

#### 우선순위

기존 SJF 스케줄링의 경우 긴 시간을 가진 프로세스가 실행되지 않는 현상이 있었다.
이를 오래된 작업일수록 ‘우선순위를 높이는 방법(aging)’을 통해 단점을 보완한 알고리즘을 말한다.

여기서 우선순위는 작업의 시간, 프로세스의 메모리 요구사항, 열린 파일 수, 평균 CPU 사용량 등을 고려해서 설정된다.

[참고]
우선순위 알고리즘은 SJF + 우선순위를 말하는 것 뿐만 아니라 FCFS를 활용하여 만들기도 하며
선점형, 비선점형적인 우선순위 스케줄링 알고리즘을 말하기도 한다.

<br />

### 선점형

선점형 방식(preemptive)은 현대 운영체제가 쓰는 방식으로 지금 사용하고 있는 프로세스를
알고리즘에 의해 중단시켜 버리고 강제로 다른 프로세스에 CPU 소유권을 할당할 수도 있는 방식을 말한다.

#### 라운드 로빈

라운드 로빈(RR, Round Robin)은 현대 컴퓨터가 쓰는 스케줄링방법이며 단순한 선점형 알고리즘이다. 
각 프로세스는 동일한 할당 시간을 주고 그 시간 안에 끝나지 않으면 다시 준비 큐(ready queue)의 뒤로 가는 알고리즘이다.

예를 들어 q만큼의 할당 시간이 부여되었고 N개의 프로세스가 운영된다고 하면 
(N - 1)* q 시간이 지나면 자기 차례가 오게 된다.

할당 시간이 너무 크면 FCFS가 되고 짧으면 컨텍스트 스위칭이 잦아져서 오버헤드, 즉 비용이 커진다.

![img](https://velog.velcdn.com/images/leesfact/post/8812748e-6398-436a-bb45-70005f95271d/image.png)

<br />

#### SRF

SJF는 중간에 실행 시간이 더 짧은 작업이 들어와도 기존 짧은 작업을 모두 수행하고 그다음 짧은 작업을 이어나가는데, 
SRF(SRTF라고도 함, Shortest Remaining Time First)는 중간에 더 짧은 작업이 들어오면 
수행하던 프로세스를 중지하고 해당 프로세스를 수행하는 알고리즘이다.

<br />

#### 다단계 큐

다단계 큐는 우선순위에 따른 준비 큐를 여러 개 사용하고, 큐마다 라운드 로빈이나 FCFS 등 
다른 스케줄링 알고리즘을 적용한 것을 말한다. 
큐 간의 프로세스 이동이 안 되므로 스케줄링 부담이 적지만 유연성이 떨어지는 특징이 있다. 
우선순위가 높은 큐부터 처리되기 때문에 낮은 큐의 프로세스가 처리가 안되는 기아현상(starvation)이 발생할 수도 있다.

![img](https://velog.velcdn.com/images/leesfact/post/74a9720c-89ff-49d3-b23b-71340a28eb4c/image.png)

---

## 인터럽트

인터럽트(interrupt)는 어떤 신호가 들어왔을 때 CPU를 잠깐 정지시키는 것을 말한다.

### 인터럽트의 종류

#### 하드웨어 인터럽트

IO 디바이스 등 하드웨어에서 발생하는 인터럽트이다. 
예를 들어 마우스를 기반으로 버튼을 클릭할 때, 디스크에서 파일읽기, 쓰기 작업이 완료되었을 때 발동된다.

#### 소프트웨어 인터럽트

트랩(trap)이라고도 한다.
프로세스 오류, 프로세스의 종료, 시작 등을 기반으로 프로세스에서 발생하는 인터럽트이다. 
하드웨어 인터럽트보다 우선순위가 높은 인터럽트이다.

<br />

### 인터럽트의 작동방식

1. 인터럽트 발생 : 인터럽트가 발생하면 인터럽트 신호가 프로세서로 전달
2. 현재 작업 중단 : 프로세서는 현재 실행 중인 명령어를 완료한 후, 현재 상태(프로그램 카운터, 레지스터 등)을 저장
3. 인터럽트 벡터 조회 : 인터럽트 벡터 테이블을 조회하여 해당 인터럽트에 대한 핸들러의 주소를 가져옴
4. 인터럽트 핸들러 실행(ISR, 인터럽트 서비스 루틴) : 인터럽트 핸들러를 실행하여 인터럽트 원인을 처리
5. 상태 복원 및 작업 재개 : 핸들러 실행이 완료되면, 저장된 상태를 복원하고 중단된 작업을 재개

![img](https://velog.velcdn.com/images/leesfact/post/afc803fa-c3b9-42e8-8ef9-b8469e9c2166/image.png)

---

## 시스템 콜

시스템콜이란 운영체제가 커널에 접근하기 위한 인터페이스이며 유저 프로그램이 운영체제의 서비스를 받기 위해 
커널 함수를 호출할 때 시스템콜을 거쳐서 호출하도록 설계되어있다.

프로세스 관리(생성, 삭제 등), 파일관리, 디바이스 관리, 시간 및 날짜 관련 시스템, 프로세스 간 통신 때 
시스템콜을 통해 커널함수를 호출한다.

[참고] 커널: 운영 체제의 핵심 부분이자 시스템 콜을 제공하며 
보안, 메모리, 프로세스, 파일 시스템, I/O 디바이스, I/O 요청 관리 등 운영 체제의 중추적인 역할을 함

### 모드 비트(Mode Bit)

-  프로세서가 현재 실행 중인 코드가 사용자 모드(user mode)인지 커널 모드(kernel mode)인지 
구분하는 데 사용(시스템의 안전성과 안정성을 보장하는데 중요한 역할)

    - 사용자 모드(User Mode) : 사용자 프로그램이 실행되는 모드로 제한된 권한만을 갖음, 
하드웨어 자원에 직접 접근할 수 없으며 시스템 콜을 통해서만 접근할 수 있음

        - 이 모드에서는 모드 비트가 1로 설정

    - 커널 모드(Kernel Mode) : 운영 체제가 실행되는 모드로 모든 하드웨어 자원에 접근할 수 있는 권한을 갖음, 
시스템 콜 처리와 같은 중요한 작업이 이 모드에서 수행

        - 이 모드에서는 모드 비트가 0으로 설정

#### 모드 비트의 작동 원리

1. 시작 시 사용자 모드 : 일반적으로 응용 프로그램은 사용자 모드에서 시작
2. 시스템 콜 호출 : 응용 프로그램이 시스템 콜을 호출하면 모드 비트가 사용자 모드에서 커널 모드로 전환
3. 커널 모드에서 시스템 콜 처리 : 운영 체제가 커널 모드에서 시스템 콜을 처리
4. 시스템 콜 종료 : 시스템 콜 처리가 완료되면 모드 비트가 다시 커널 모드에서 사용자 모드로 전환

### 시스템 콜의 장점

1. 안전한 자원 접근
   - 시스템 콜을 통해 응용 프로그램은 운영 체제의 검증을 거쳐서만 하드웨어 자원에 접근할 수 있음
   - 이는 자원에 대한 불법 접근을 방지하고 시스템의 보안과 안정성을 높임
2. 추상화 및 편리성
   - 시스템 콜은 하드웨어와의 직접적인 상호작용을 추상화하여 응용 프로그램이 복잡한 하드웨어 동작을 신경 쓰지 않고도 필요한 작업을 수행할 수 있게 함
   - 예를 들어, 파일 읽기/쓰기, 메모리 할당, 프로세스 관리 등을 쉽게 할 수 있음
3. 일관성 유지
   - 다양한 하드웨어와 플랫폼에서 일관된 인터페이스를 제공
   - 이는 응용 프로그램이 다양한 환경에서 동일한 방식으로 운영 체제의 서비스를 사용할 수 있도록 함
4. 자원 관리 및 효율성
   - 운영 체제는 시스템 콜을 통해 자원의 할당과 해제를 중앙에서 관리
   - 이를 통해 자원의 중복 사용이나 누수를 방지하고 전체 시스템의 효율성을 높일 수 있음
5. 안정성
   - 운영 체제가 응용 프래고름의 요청을 안전하게 처리할 수 있도록 함
   - 예를 들어, 잘못된 메모리 접근이나 무한 루프 등으로 인해 시스템이 불안정해지는 것을 방지
6. 보안
   - 시스템 콜을 통해 운영 체제는 각 응용 프로그램의 권한을 제어할 수 있음
   - 이를 통해 악성 프로그램이 시스템 자원에 무단 접근하는 것을 방지할 수 있음
7. 프로세스 간 통신
   - 시스템 콜은 프로세스 간 통신(IPC, Inter-Process Communication)을 지원하여 서로 다른 프로세스들이 데이터를 주고받을 수 있도록 함
   - 이를 통해 복잡한 응용 프로그램이 모듈화되고 협력하여 동작할 수 있음
