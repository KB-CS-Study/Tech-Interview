# 4️⃣ 동기화 문제 + 세마포어&뮤텍스

목차
- [💞 동기화 문제](#💞-동기화-문제)
  - [🙆🏻‍♀️Terms](#🙆🏻‍♀️terms)
- [💞 뮤텍스](#💞-뮤텍스)

- [💞 세마포어](#💞-세마포어)

- [💞 뮤텍스 VS 세마포어](#💞-뮤텍스-vs-세마포어)
---

## 💞 동기화 문제

### 🙆🏻‍♀️Terms

필수 용어 모음

<br>

**Indeterminate (비결정성)**

- 프로그램의 출력이 실행할 때마다 다르게 나타남
- 어떤 스레드가 언제 실행되었느냐에 따라 결과 변동

**Critical section (임계 영역)**

- 공유 자원에 접근하는 코드 조각
- 둘 이상의 스레드가 동시에 실행되면 안되는 부분

**Race condition (경쟁 상태)**

- 여러 스레드가 거의 동시에 임계 영역에 진입하려할 때 발생
- 여럿이 공유 데이터를 변경하려고 시도하면, 예상치 못한 결과 발생

**Atomicity (원자성)**

- 작업이 전부 실행되거나, 실행되지 않는 성질

**Mutual exclusion (상호 배제)**

- 하나의 스레드가 임계 구역에서 실행 중이면, 다른 스레드는 진입하지 못하도록 보장

  <br>

### ☘️ Race Condition(경쟁 상태)

두 개 이상의 프로세스가 동시에 하나의 공유 자원에 접근할 때,

**실행 순서에 따라 결과가 달라지는 문제**

![image](https://github.com/user-attachments/assets/bc409ac0-1941-45b4-812f-239a656786c6)


- **발생 조건**
    - 두 개 이상의 스레드/프로세스 존재
    - 공유 자원에 접근
    - 적절한 동기화 없이 동시 접근
    
- **해결 방법** : 임계 구역 보호(세마포어, 뮤텍스)

<br>

### ☘️ Deadlock(교착 상태)

두 개 이상의 프로세스가 서로 자원을 점유한 채, 

**상대방이 가진 자원을 기다리면서 무한 대기하는 상태**

- **발생 필수 조건 4가지**
    - **상호 배제** : 자원은 한 번에 하나의 프로세스만 사용 가능
    - **점유 대기** : 자원을 점유한 채 다른 자원 대기
    - **비선점** : 점유한 자원을 강제로 뺏을 수 없음
    - **순환 대기** : 프로세스들이 자원을 서로 순환적으로 기다림

- **데드락 해결 방법**
    - **예방** : 데드락 발생 필수 조건 중 하나 이상을 사전에 차단 → 발생 예방
    - **회피** : 데드락이 발생할 수 있는 상태를 미리 탐지하고 회피(ex, 은행가 알고리즘)
    - **탐지 및 복구** : 데드락 발생 후 탐지하고 복구

<br>

## 💞 뮤텍스

**한 번에 오직 하나의 스레드**만 특정 자원에 접근할 수 있도록 제한하는 도구

ex) 화장실(1개)에 갈 때 카운터에서 열쇠를 가져가야하는 식당, 내가 열쇠를 가지고 가면 다음 사람은 대기

```java
global counter = 0
mutex lock = new mutex()

function thread_function():
    for i in 1 to 1000:
        lock.acquire()         // 🔒 뮤텍스 잠금
        counter = counter + 1  // 🔧 임계영역: 공유 자원 접근
        lock.release()         // 🔓 뮤텍스 해제

```

![image](https://github.com/user-attachments/assets/64938238-9c32-4385-b264-c19a41fceb83)


<br>

## 💞 세마포어

동시에 접근 가능한 스레드 수를 제한하는 도구

**세마포어의 값**은 접근 가능한 “**토큰**”의 개수 의미  `sem_wait()`  `sem_post()`

세마포어 값이 0이 되면, 다른 스레드는 `sem.acquire()` 에서 대기

ex) 화장실 여러개가 있는 식당, 화장실 입구에 빈 칸 수 표기

![image](https://github.com/user-attachments/assets/54e9c81e-26e5-41e4-b53e-6b4b3182a983)


```java
sem_t sem;

sem_init(&sem, 0, 1); // 세마포어 초기화 (초기값 1)

void* thread_func(void* arg) {
    sem_wait(&sem);     // 세마포어 잠금 → 임계영역 진입

    // 🔒 임계영역
    // 공유 자원에 대한 작업 수행
    ...

    sem_post(&sem);     // 세마포어 해제 → 다른 스레드에게 자원 반환
    return NULL;
}

```

![image](https://github.com/user-attachments/assets/24437398-0dd0-4f53-9d2d-ea3ab222a784)


## 💞 뮤텍스 VS 세마포어

![image](https://github.com/user-attachments/assets/5d92191f-b89a-4431-a66a-fbab1b416c0c)
